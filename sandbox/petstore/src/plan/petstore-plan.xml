<?xml version="1.0" encoding="UTF-8"?>
<!--

    Copyright 2005 The Apache Software Foundation

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<!-- $Rev: 54661 $ $Date$ -->
<application xmlns="http://geronimo.apache.org/xml/ns/j2ee/application" parentId="org/apache/geronimo/SystemDatabase" configId="petstore">
  <module>
    <connector>geronimo-derby-connector-1.0-SNAPSHOT.rar</connector>
    <alt-dd>geronimo-derby-connector-plan.xml</alt-dd>
  </module>
  <module>
    <ejb>petstore-ejb.jar</ejb>
    <openejb-jar xmlns="http://www.openejb.org/xml/ns/openejb-jar" xmlns:naming="http://geronimo.apache.org/xml/ns/naming" configId="petstore-ejb">
      <enterprise-beans>
        <session>
          <ejb-name>CatalogEJB</ejb-name>
          <naming:resource-ref>
            <naming:ref-name>jdbc/CatalogDB</naming:ref-name>
            <naming:resource-link>DerbyDatasource</naming:resource-link>
          </naming:resource-ref>
          <naming:resource-ref>
            <naming:ref-name>url/CatalogDAOSQLURL</naming:ref-name>
            <naming:url>http://localhost:8080/petstore/CatalogDAOSQL.xml</naming:url>
          </naming:resource-ref>
        </session>
      </enterprise-beans>
    </openejb-jar>
  </module>
  <module>
    <ejb>customer-ejb.jar</ejb>
    <alt-dd>customer-ejb-plan.xml</alt-dd>
  </module>
  <module>
    <ejb>asyncsender-ejb.jar</ejb>
    <alt-dd>asyncsender-ejb-plan.xml</alt-dd>
  </module>
  <module>
    <ejb>cart-ejb.jar</ejb>
    <openejb-jar xmlns="http://www.openejb.org/xml/ns/openejb-jar" xmlns:naming="http://geronimo.apache.org/xml/ns/naming" configId="cart-ejb">
      <enterprise-beans>
        <session>
          <ejb-name>CatalogEJB</ejb-name>
          <naming:resource-ref>
            <naming:ref-name>jdbc/CatalogDB</naming:ref-name>
            <naming:resource-link>DerbyDatasource</naming:resource-link>
          </naming:resource-ref>
          <naming:resource-ref>
            <naming:ref-name>url/CatalogDAOSQLURL</naming:ref-name>
            <naming:url>http://localhost:8080/petstore/CatalogDAOSQL.xml</naming:url>
          </naming:resource-ref>
        </session>
      </enterprise-beans>
    </openejb-jar>
  </module>
  <module>
    <ejb>signon-ejb.jar</ejb>
    <openejb-jar xmlns="http://www.openejb.org/xml/ns/openejb-jar" xmlns:naming="http://geronimo.apache.org/xml/ns/naming" configId="signon-ejb">
      <naming:cmp-connection-factory>
        <naming:resource-link>DerbyDatasource</naming:resource-link>
      </naming:cmp-connection-factory>
      <enterprise-beans>
        <entity>
          <ejb-name>UserEJB</ejb-name>
          <table-name>USERS</table-name>
          <cmp-field-mapping>
            <cmp-field-name>password</cmp-field-name>
            <table-column>password</table-column>
          </cmp-field-mapping>
          <cmp-field-mapping>
            <cmp-field-name>userName</cmp-field-name>
            <table-column>userName</table-column>
          </cmp-field-mapping>
        </entity>
      </enterprise-beans>
    </openejb-jar>
  </module>
  <module>
    <ejb>uidgen-ejb.jar</ejb>
    <openejb-jar xmlns="http://www.openejb.org/xml/ns/openejb-jar" xmlns:naming="http://geronimo.apache.org/xml/ns/naming" configId="uidgen-ejb">
      <naming:cmp-connection-factory>
        <naming:resource-link>DerbyDatasource</naming:resource-link>
      </naming:cmp-connection-factory>
      <enterprise-beans>
        <entity>
          <ejb-name>CounterEJB</ejb-name>
          <table-name>COUNTER</table-name>
          <cmp-field-mapping>
            <cmp-field-name>counter</cmp-field-name>
            <table-column>COUNTER</table-column>
          </cmp-field-mapping>
          <cmp-field-mapping>
            <cmp-field-name>name</cmp-field-name>
            <table-column>NAME</table-column>
          </cmp-field-mapping>
        </entity>
      </enterprise-beans>
    </openejb-jar>
  </module>
  <module>
    <ejb>catalog-ejb.jar</ejb>
    <openejb-jar xmlns="http://www.openejb.org/xml/ns/openejb-jar" xmlns:naming="http://geronimo.apache.org/xml/ns/naming" configId="catalog-ejb">
      <enterprise-beans>
        <session>
          <ejb-name>CatalogEJB</ejb-name>
          <naming:resource-ref>
            <naming:ref-name>jdbc/CatalogDB</naming:ref-name>
            <naming:resource-link>DerbyDatasource</naming:resource-link>
          </naming:resource-ref>
          <naming:resource-ref>
            <naming:ref-name>url/CatalogDAOSQLURL</naming:ref-name>
            <naming:url>http://localhost:8080/petstore/CatalogDAOSQL.xml</naming:url>
          </naming:resource-ref>
        </session>
      </enterprise-beans>
    </openejb-jar>
  </module>
  <module>
    <web>petstore.war</web>
    <web-app xmlns="http://geronimo.apache.org/xml/ns/web" xmlns:naming="http://geronimo.apache.org/xml/ns/naming" configId="petstore-war">
      <context-priority-classloader>false</context-priority-classloader>
      <naming:ejb-local-ref>
        <naming:ref-name>ShoppingControllerEJB</naming:ref-name>
        <naming:ejb-link>#ShoppingControllerEJB</naming:ejb-link>
      </naming:ejb-local-ref>
      <naming:resource-ref>
        <naming:ref-name>jdbc/CatalogDB</naming:ref-name>
        <naming:resource-link>DerbyDatasource</naming:resource-link>
      </naming:resource-ref>
      <naming:resource-ref>
        <naming:ref-name>url/CatalogDAOSQLURL</naming:ref-name>
        <naming:url>http://localhost:8080/petstore/CatalogDAOSQL.xml</naming:url>
      </naming:resource-ref>
    </web-app>
  </module>
  <module>
    <connector>activemq-ra-3.1-SNAPSHOT.rar</connector>
    <connector xmlns="http://geronimo.apache.org/xml/ns/j2ee/connector" version="1.5" configId="activemq-ra">
      <dependency>
        <uri>activemq/jars/activemq-core-3.1-SNAPSHOT.jar</uri>
      </dependency>
      <resourceadapter>
        <resourceadapter-instance>
          <resourceadapter-name>PetStore JMS Resources</resourceadapter-name>
          <config-property-setting name="ServerUrl">tcp://localhost:61616</config-property-setting>
          <config-property-setting name="UserName">geronimo</config-property-setting>
          <config-property-setting name="Password">geronimo</config-property-setting>
          <workmanager>
            <gbean-link>DefaultWorkManager</gbean-link>
          </workmanager>
        </resourceadapter-instance>
        <outbound-resourceadapter>
          <connection-definition>
            <connectionfactory-interface>javax.jms.ConnectionFactory</connectionfactory-interface>
            <connectiondefinition-instance>
              <name>QueueConnectionFactory</name>
              <implemented-interface>javax.jms.QueueConnectionFactory</implemented-interface>
              <implemented-interface>javax.jms.TopicConnectionFactory</implemented-interface>
              <connectionmanager>
                <xa-transaction>
                  <transaction-caching/>
                </xa-transaction>
                <single-pool>
                  <max-size>10</max-size>
                  <blocking-timeout-milliseconds>5000</blocking-timeout-milliseconds>
                  <match-one/>
                </single-pool>
              </connectionmanager>
              <global-jndi-name>jms/ConnectionFactoryLocalTx</global-jndi-name>
              <credential-interface>javax.resource.spi.security.PasswordCredential</credential-interface>
            </connectiondefinition-instance>
          </connection-definition>
        </outbound-resourceadapter>
      </resourceadapter>
      <adminobject>
        <adminobject-interface>javax.jms.Queue</adminobject-interface>
        <adminobject-class>org.codehaus.activemq.message.ActiveMQQueue</adminobject-class>
        <adminobject-instance>
          <message-destination-name>AsyncSenderQueue</message-destination-name>
          <config-property-setting name="PhysicalName">AsyncSenderQueue</config-property-setting>
        </adminobject-instance>
      </adminobject>
    </connector>
  </module>
</application>

