<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- $Revision: 1.13 $ $Date: 2004/09/14 21:39:52 $ -->

<project default="default"
    xmlns:j="jelly:core"
    xmlns:ant="jelly:ant"
    xmlns:deploy="geronimo:deploy"
    xmlns:maven="jelly:maven"
    xmlns:u="jelly:util"
    xmlns:define="jelly:define"
    >

    <preGoal name="xdoc:jelly-transform">
        <attainGoal name="html2xdoc"/>
    </preGoal>

    <goal name="default" prereqs="jar:install"/>

    <postGoal name="jar:install">
        <attainGoal name="deploy"/>
    </postGoal>


    <goal name="deploy">
        <ant:delete dir="${maven.build.dir}/geronimo"/>
        <deploy:unpackServer
            geronimoVersion="${geronimo_version}"
            geronimoName="geronimo"
            targetDir="${maven.build.dir}/geronimo"/>
        <deploy:startRemoteServer
            geronimoTarget="${maven.build.dir}/geronimo"
            configs="org/apache/geronimo/Server"/>
        <ant:echo message="Waiting for server at: ${geronimoTarget}"/>
        <deploy:waitForStarted
            uri="deployer:geronimo:jmx:rmi://localhost/jndi/rmi:/JMXConnector"
            username="system"
            password="manager"
            id="org/apache/geronimo/Server"/>
        <echo message="server has started"/>
        <deploy:distribute
            uri="deployer:geronimo:jmx:rmi://localhost/jndi/rmi:/JMXConnector"
            username="system"
            password="manager"
            module="${basedir}/target/${pom.artifactId}-${pom.currentVersion}.jar"
            plan="${basedir}/src/plan/plan1.xml"
            />
        <echo message="distributed client app"/>
        <!--deploy:start
            uri="deployer:geronimo:jmx:rmi://localhost/jndi/rmi:/JMXConnector"
            username="system"
            password="manager"
            id="org/openejb/Itests"/-->
    <!--/preGoal>

    <preGoal name="itest:teardown"-->
         <!--deploy:stop
            uri="deployer:geronimo:jmx:rmi://localhost/jndi/rmi:/JMXConnector"
            username="system"
            password="manager"
            id="org/openejb/Itests"/>
        <deploy:undeploy
            uri="deployer:geronimo:jmx:rmi://localhost/jndi/rmi:/JMXConnector"
            username="system"
            password="manager"
            id="org/openejb/Itests"/>
        <echo message="undeployed ejbs"/-->
        <deploy:stopRemoteServer
            uri="deployer:geronimo:jmx:rmi://localhost/jndi/rmi:/JMXConnector"
            username="system"
            password="manager"/>
        <echo message="server has stopped"/>
    </goal>

</project>
