<?xml version="1.0" encoding="UTF-8"?>
<application-client xmlns="http://geronimo.apache.org/xml/ns/j2ee/application-client"
    clientConfigId="org/apache/geronimo/itest/naming/Client"
    configId="org/apache/geronimo/itest/naming/ClientServer"
    parentId="org/apache/geronimo/Server">
    <resource-ref>
        <ref-name>jdbc/DefaultDatasource</ref-name>
        <target-name>DefaultDatasource</target-name>
    </resource-ref>
    <resource-ref>
        <ref-name>jms/JMSConnectionFactory</ref-name>
        <target-name>DefaultActiveMQConnectionFactory</target-name>
    </resource-ref>
    <resource-env-ref>
        <ref-name>jms/Queue</ref-name>
        <target-name>MDBTransferBeanOutQueue</target-name>
    </resource-env-ref>
    <resource>
        <external-rar>tranql/rars/tranql-connector-1.0-SNAPSHOT.rar</external-rar>
        <connector xmlns="http://geronimo.apache.org/xml/ns/j2ee/connector"
            version="1.5"
            configId="org/apache/geronimo/DefaultDatabase"
            >

            <dependency>
                <uri>axion/jars/axion-1.0-M3-dev.jar</uri>
            </dependency>
            <dependency>
                <uri>commons-collections/jars/commons-collections-2.1.jar</uri>
            </dependency>

            <dependency>
                <uri>commons-primitives/jars/commons-primitives-1.0.jar</uri>
            </dependency>

            <dependency>
                <uri>regexp/jars/regexp-1.3.jar</uri>
            </dependency>

            <resourceadapter>
                <outbound-resourceadapter>
                    <connection-definition>
                        <connectionfactory-interface>javax.sql.DataSource</connectionfactory-interface>
                        <connectiondefinition-instance>
                            <name>DefaultDatasource</name>
                            <config-property-setting name="UserName"></config-property-setting>
                            <config-property-setting name="Password"></config-property-setting>
                            <config-property-setting name="Driver">org.axiondb.jdbc.AxionDriver</config-property-setting>
                            <config-property-setting name="ConnectionURL">jdbc:axiondb:DefaultDatabase</config-property-setting>
                            <config-property-setting name="CommitBeforeAutocommit">true</config-property-setting>
                            <config-property-setting name="ExceptionSorterClass">org.tranql.connector.NoExceptionsAreFatalSorter</config-property-setting>
                            <connectionmanager>
                                <local-transaction/>
                                <single-pool>
                                    <max-size>10</max-size>
                                    <blocking-timeout-milliseconds>5000</blocking-timeout-milliseconds>
                                    <match-one/>
                                </single-pool>
                            </connectionmanager>
                            <global-jndi-name>tranql/axion</global-jndi-name>
                            <!--credential-interface>javax.resource.spi.security.PasswordCredential</credential-interface-->
                        </connectiondefinition-instance>
                    </connection-definition>
                </outbound-resourceadapter>
            </resourceadapter>

        </connector>

    </resource>
    <resource>
        <external-rar>activemq/rars/activemq-1.1-SNAPSHOT.rar</external-rar>
        <connector xmlns="http://geronimo.apache.org/xml/ns/j2ee/connector" version="1.5"
          configId="org.codehaus.activemq.ra/default"
          >
          <resourceadapter>
            <resourceadapter-instance>
              <resourceadapter-name>ActiveMQ RA</resourceadapter-name>
              <config-property-setting name="ServerUrl">vm://localhost</config-property-setting>
              <config-property-setting name="UserName">geronimo</config-property-setting>
              <config-property-setting name="Password">geronimo</config-property-setting>
              <config-property-setting name="XA">true</config-property-setting>
              <workmanager-name>DefaultWorkManager</workmanager-name>
            </resourceadapter-instance>
            <outbound-resourceadapter>
              <connection-definition>
                <connectionfactory-interface>javax.jms.ConnectionFactory</connectionfactory-interface>
                <connectiondefinition-instance>
                  <name>DefaultActiveMQConnectionFactory</name>
                  <connectionmanager>
                    <xa-transaction>
                      <transaction-caching/>
                    </xa-transaction>
                    <single-pool>
                      <max-size>10</max-size>
                      <blocking-timeout-milliseconds>5000</blocking-timeout-milliseconds>
                      <match-one/>
                    </single-pool>
                  </connectionmanager>
                  <!--credential-interface>javax.resource.spi.security.PasswordCredential</credential-interface-->
                </connectiondefinition-instance>
              </connection-definition>
            </outbound-resourceadapter>
            <adminobject>
              <adminobject-interface>javax.jms.Queue</adminobject-interface>
              <adminobject-class>org.codehaus.activemq.message.ActiveMQQueue</adminobject-class>
              <adminobject-instance>
                <message-destination-name>MDBTransferBeanOutQueue</message-destination-name>
                <config-property-setting name="PhysicalName">MDBTransferBeanOutQueue</config-property-setting>
              </adminobject-instance>
            </adminobject>
            <adminobject>
              <adminobject-interface>javax.jms.Queue</adminobject-interface>
              <adminobject-class>org.codehaus.activemq.message.ActiveMQQueue</adminobject-class>
              <adminobject-instance>
                <message-destination-name>SendReceiveQueue</message-destination-name>
                <config-property-setting name="PhysicalName">SendReceiveQueue</config-property-setting>
              </adminobject-instance>
            </adminobject>
          </resourceadapter>

          <gbean name="geronimo.client:type=JMSServer,container=ActiveMQ" class="org.codehaus.activemq.gbean.ActiveMQContainer">
            <attribute name="brokerName" type="java.lang.String">possibly-unique-broker</attribute>
          </gbean>
          <gbean name='geronimo.client:type=JMSConnector,container=ActiveMQ,url="tcp://localhost:61616"' class="org.codehaus.activemq.gbean.ActiveMQConnector">
            <attribute name="Url" type="java.lang.String">tcp://localhost:61616</attribute>
            <reference name="ActiveMQContainer">geronimo.server:type=JMSServer,container=ActiveMQ</reference>
          </gbean>
          <gbean name='geronimo.client:type=JMSConnector,container=ActiveMQ,url="vm://localhost"' class="org.codehaus.activemq.gbean.ActiveMQConnector">
            <attribute name="Url" type="java.lang.String">vm://localhost</attribute>
            <reference name="ActiveMQContainer">geronimo.server:type=JMSServer,container=ActiveMQ</reference>
          </gbean>
        </connector>

    </resource>
</application-client>
