<?xml version="1.0" encoding="UTF-8"?>
<application
    xmlns="http://geronimo.apache.org/xml/ns/j2ee/application-1.1">
<!--    configId="org/apache/geronimo/MagicGBallCorba"
    parentId="org/apache/geronimo/ServerCORBA">

    <import>
        <uri>org/apache/geronimo/Security</uri>
    </import>
    -->
    <environment>
      <moduleId>
        <groupId>geronimo</groupId>
        <artifactId>magicGBall-corba-ssl</artifactId>
        <version>${version}</version>
        <type>car</type>
      </moduleId>
      <dependencies>
        <dependency>
          <groupId>geronimo</groupId>
          <artifactId>j2ee-corba</artifactId>
          <type>car</type>
        </dependency>
      </dependencies>
      <hidden-classes/>
      <non-overridable-classes/>
    </environment>

    <module>
        <ejb>magicGball-ejb-${geronimo_version}.jar</ejb>
        <openejb-jar
            xmlns="http://www.openejb.org/xml/ns/openejb-jar-2.1">
<!--            configId="MagicGBallEJB"
            parentId="org/apache/geronimo/ServerCORBA">
    -->
            <enterprise-beans>
                <session>
                    <ejb-name>MagicGBall</ejb-name>
                    <jndi-name>MagicGBall</jndi-name>
                    <tss-link>SSLClientPassword</tss-link>
                </session>
            </enterprise-beans>
            <gbean name="SSLClientPassword" class="org.apache.openejb.corba.TSSBean">
                <attribute name="POAName">SSLClientPassword</attribute>
                <reference name="Server">
                    <name>Server</name>
                </reference>
                <xml-attribute name="tssConfig">
                    <tss:tss xmlns:tss="http://www.openejb.org/xml/ns/corba-tss-config-2.0" xmlns:sec="http://geronimo.apache.org/xml/ns/security-1.1">
                        <tss:default-principal>
                            <sec:principal class="org.apache.geronimo.security.realm.providers.GeronimoUserPrincipal" name="guest"/>
                        </tss:default-principal>
                        <tss:SSL port="${PlanORBSSLPort}" hostname="${PlanORBSSLHost}">
                            <tss:supports>Integrity Confidentiality EstablishTrustInTarget</tss:supports>
                            <tss:requires>Integrity Confidentiality</tss:requires>
                        </tss:SSL>
                        <tss:compoundSecMechTypeList>
                            <tss:compoundSecMech>
                                <tss:GSSUP required="true" targetName="default"/>
                                <tss:sasMech>
                                    <tss:identityTokenTypes>
                                        <tss:ITTAbsent/>
                                    </tss:identityTokenTypes>
                                </tss:sasMech>
                            </tss:compoundSecMech>
                        </tss:compoundSecMechTypeList>
                    </tss:tss>
                </xml-attribute>
            </gbean>

        </openejb-jar>
    </module>

    <module>
        <web>magicGball-${geronimo_version}.war</web>
        <web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web/jetty-1.1">
            <!--configId="MagicGBallWAR">-->
        </web-app>
    </module>

    <module>
        <java>magicGball-client-${geronimo_version}.jar</java>
        <application-client xmlns="http://geronimo.apache.org/xml/ns/j2ee/application-client-1.1">
            <!--configId="client"-->
            <!--clientConfigId="org/apache/geronimo/MagicGBallClient"-->
            <!--clientParentId="org/apache/geronimo/ClientCORBA">-->
            <!--<import>-->
                <!--<uri>org/apache/geronimo/ClientSecurity</uri>-->
            <!--</import>-->
            <client-environment>
              <moduleId>
                <groupId>geronimo</groupId>
                <artifactId>magicGBall-corba-ssl-client</artifactId>
                <version>${version}</version>
                <type>car</type>
              </moduleId>
              <dependencies>
                <dependency>
                  <groupId>geronimo</groupId>
                  <artifactId>client-corba</artifactId>
                  <type>car</type>
                </dependency>
              </dependencies>
              <hidden-classes/>
              <non-overridable-classes/>
            </client-environment>
            <server-environment>
            </server-environment>
            <ejb-ref>
                <ref-name>mGball</ref-name>
                <ns-corbaloc>corbaloc::localhost:1050/NameService</ns-corbaloc>
                <name>MagicGBall</name>
                <css-link>SSLClientPassword</css-link>
            </ejb-ref>
            <realm-name>client-properties-realm</realm-name>
            <callback-handler>org.acme.MagicGBallCallbackHandler</callback-handler>
            <gbean name="SSLClientPassword" class="org.apache.openejb.corba.CSSBean">
                <reference name="ThreadPool">
                    <name>DefaultThreadPool</name>
                </reference>
                <reference name="TransactionContextManager">
                    <name>TransactionContextManager</name>
                </reference>
                <attribute name="configAdapter">org.apache.openejb.corba.sunorb.SunORBConfigAdapter</attribute>
                <attribute name="description">SSLClientPassword</attribute>
                <xml-attribute name="nssConfig">
                    <css:css xmlns:css="http://www.openejb.org/xml/ns/corba-css-config-2.0">
                        <css:compoundSecMechTypeList>
                            <css:compoundSecMech>
                                <css:SSL>
                                    <css:supports>Integrity Confidentiality EstablishTrustInTarget EstablishTrustInClient</css:supports>
                                    <css:requires></css:requires>
                                </css:SSL>
                            </css:compoundSecMech>
                        </css:compoundSecMechTypeList>
                    </css:css>
                </xml-attribute>
                <xml-attribute name="cssConfig">
                    <css:css xmlns:css="http://www.openejb.org/xml/ns/corba-css-config-2.0">
                        <css:compoundSecMechTypeList>
                            <css:compoundSecMech>
                                <css:SSL>
                                    <css:supports>Integrity Confidentiality EstablishTrustInClient</css:supports>
                                    <css:requires>Integrity Confidentiality</css:requires>
                                </css:SSL>
                                <css:GSSUPStatic username="system" password="manager" domain="default"/>
                                <css:sasMech>
                                    <css:ITTAbsent/>
                                </css:sasMech>
                            </css:compoundSecMech>
                        </css:compoundSecMechTypeList>
                    </css:css>
                </xml-attribute>
            </gbean>

        </application-client>
    </module>

    <security>
        <default-principal>
            <principal class="org.apache.geronimo.security.realm.providers.GeronimoUserPrincipal" name="system"/>
        </default-principal>
        <role-mappings>
            <role role-name="admin">
                <principal class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal" name="admin" designated-run-as="true"/>
            </role>
        </role-mappings>
    </security>

    <dep:gbean name="default"
         class="org.apache.geronimo.security.realm.GenericSecurityRealm"
        xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.1">
         <dep:attribute name="realmName">default</dep:attribute>
         <dep:xml-reference name="LoginModuleConfiguration">
             <lc:login-config xmlns:lc="http://geronimo.apache.org/xml/ns/loginconfig-1.1">
                 <lc:login-module control-flag="REQUIRED" server-side="true">
                     <lc:login-domain-name>default</lc:login-domain-name>
                     <lc:login-module-class>org.apache.geronimo.security.realm.providers.PropertiesFileLoginModule</lc:login-module-class>
                     <lc:option name="usersURI">var/security/users.properties</lc:option>
                     <lc:option name="groupsURI">var/security/groups.properties</lc:option>
                 </lc:login-module>
             </lc:login-config>
         </dep:xml-reference>
         <dep:reference name="ServerInfo">
             <dep:name>ServerInfo</dep:name>
         </dep:reference>
         <dep:reference name="LoginService">
             <dep:name>JaasLoginService</dep:name>
         </dep:reference>
     </dep:gbean>

</application>
