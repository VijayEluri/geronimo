Private Build of Tomcat for Geronimo.										       

How to build Tomcat 6_0_14 with modifications for Geronimo:

Checkout tomcat 6.0.14
  svn co  https://svn.apache.org/repos/asf/tomcat/tc6.0.x/tags/TOMCAT_6_0_14  tomcat_6_0_14

svn info for Tomcat image:
Path: .
URL: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/tags/TOMCAT_6_0_14
Repository Root: https://svn.apache.org/repos/asf
Repository UUID: 13f79535-47bb-0310-9956-ffa450edef68
Revision: 602188
Node Kind: directory
Schedule: normal
Last Changed Author: remm
Last Changed Rev: 557842
Last Changed Date: 2007-07-19 21:43:38 -0400 (Thu, 19 Jul 2007)
Properties Last Updated: 2007-12-07 14:29:52 -0500 (Fri, 07 Dec 2007)


Apply the custom patch for Geronimo Annotation changes, Webdav fix, and build fix.
  cd tomcat_6_0_14
  patch -p0 -u < tomcat_6_0_14-G602188.patch   (checked in as a peer to this file)
  -  Respond "y" to the 3 prompts "Reversed (or previously applied) patch detected!  Assume -R? [n]"
  svn delete java/org/apache/jasper/runtime/AnnotationHelper.java --force
  svn delete java/org/apache/AnnotationProcessor.java --force
  svn delete java/org/apache/catalina/util/DefaultAnnotationProcessor.java --force

Build tomcat
  cd tomcat_6_0_14
  Per tomcat build instructions install ant-1.6.5 or later and set ANT_HOME as well as add ant/bin to PATH
  You must run as the super user for the first build that downloads more ant & eclipse artifacts
  ant download   - to setup build for tomcat
  Exit super user
  ant - to build tomcat artifacts

Copy to appropriate jars and rename into geronimo/repository
  cd tomcat_6_0_14
  cp /build/lib/catalina.jar <geronimo-root>/repository/org/apache/tomcat/catalina/6.0.14-G602188/catalina-6.0.14-G602188.jar
  cp /build/lib/jasper.jar   <geronimo-root>/repository/org/apache/tomcat/jasper/6.0.14-G602188/jasper-6.0.14-G602188.jar







How the patch was created:

Checkout tomcat 6.0.14
  svn co  https://svn.apache.org/repos/asf/tomcat/tc6.0.x/tags/TOMCAT_6_0_14  tomcat_6_0_14


Apply annotation changes from old tomcat trunk
  cd tomcat_6_0_14
  svn merge -r 542188:542189 https://svn.apache.org/repos/asf/tomcat/sandbox/gdev6x/ .
  manually correct merge conflicts

Apply the Webdav security fix from the new tomcat trunk
  svn merge -r 587081:587082 https://svn.apache.org/repos/asf/tomcat/trunk/ .
  manually correct merge conflicts

Fix the tomcat build properties before attempting "ant download" 
  - Before you can build tomcat you need to make some manual changes to build.properties.default
  - replace jdt.jar=${jdt.lib}/org.eclipse.jdt.core_3.2.3.v_686_R32x.jar
    with jdt.jar=${jdt.lib}/org.eclipse.jdt.core_3.3.1.v_780_R33x.jar
  and
  - replace jdt.loc=http://sunsite.informatik.rwth-aachen.de/eclipse/downloads/drops/R-3.2.2-200702121330/eclipse-JDT-3.2.2.zip
    with jdt.loc=http://www.eclipse.org/downloads/download.php?file=/eclipse/downloads/drops/R-3.3.1-200709211145/eclipse-JDT-3.3.1.zip

The merge earlier keeps a history on added parts.  As a result, the added parts will not appear on patch created from this image.  To correct
this we must revert the addition changes and manually add the parts back.  Perform the following commands:
  svn revert java/org/apache/InstanceManager.java
  svn add    java/org/apache/InstanceManager.java
  svn revert java/org/apache/jasper/runtime/InstanceManagerFactory.java
  svn add    java/org/apache/jasper/runtime/InstanceManagerFactory.java
  svn revert java/org/apache/catalina/deploy/InjectionTarget.java
  svn add    java/org/apache/catalina/deploy/InjectionTarget.java

Create the patch:
  svn diff > TOMCAT_6_0_14-G602188.patch




