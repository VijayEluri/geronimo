<?xml version="1.0" encoding="UTF-8"?>

<!-- $Revision: 1.1 $ $Date: 2003/08/22 11:18:56 $ -->

<project
  xmlns:j="jelly:core"
  xmlns:u="jelly:util"
  xmlns:ant="jelly:ant"
  xmlns:castor="castor">
  
  <!-- ===================== -->
  <!-- Module Initialization -->
  <!-- ===================== -->
  
  <ant:property file="${basedir}/../../etc/project.properties"/>
  
  
  <preGoal name="xdoc:jelly-transform">
    <attainGoal name="html2xdoc"/>
  </preGoal>

  <preGoal name="site">
	<attainGoal name="java:compile"/>      
	<attainGoal name="javadoc"/>      
  </preGoal>

  <preGoal name="java:compile">
	<attainGoal name="generate:xmlbeans"/>      
  </preGoal>


  <!-- ================================= -->
  <!-- Compile XML->Java Binding Sources -->
  <!-- ================================= -->
  
  <goal name="generate:xmlbeans"
  	description="Generates the XML beans using XMLBeans">

   	<!-- a dummy scope tag to change XML namespace to ant -->
  	<j:scope xmlns="jelly:ant">
      <mkdir dir="${dir}"/>
      
<!-- currently there's a classloader bug with xsdconfig files with Ant task
  	  <taskdef name="xmlbean" classname="com.bea.xbean.tool.XMLBean" classpathref="maven.dependency.classpath"/>
        
	  <xmlbean
	    schema="${basedir}/src/schema"
	    srcgendir="${basedir}/target/src"
        classpathref="maven.dependency.classpath" 
        srconly="true"
	    download="true"
	    failonerror="true" />
-->

      <java classname="com.bea.xbean.tool.SchemaCompiler" fork="yes">
        <classpath refid="maven.dependency.classpath"/>
        <arg value="-src"/>
        <arg value="${basedir}/target/src/schema"/>
        <arg value="-srconly"/>
        <arg value="-dl"/>
        <arg value="on"/>
        <arg value="${basedir}/src"/>
      </java>
    </j:scope>
  </goal>
  	


  <goal name="generate:jaxb"
  	description="Generates the XML beans using JAXB">

   	<!-- a dummy scope tag to change XML namespace to ant -->
  	<j:scope xmlns="jelly:ant">

<!--  	
 	   <j:set var="schema" value="${basedir}/src/schema/j2ee_1_4.xsd"/>
--> 	   
 	   <j:set var="schema" value="${basedir}/src/schema/ejb-jar_2_1.xsd"/>
 	   <j:set var="dir" value="${basedir}/target/src"/>
    
        <taskdef name="xjc" classname="com.sun.tools.xjc.XJCTask">
          <classpath refid="maven.dependency.classpath" />
    	</taskdef>
        
        <ant:mkdir dir="${dir}"/>
        
        <xjc target="${dir}" package="org.apache.geronimo.xmlbeans.ejb" extension="true">
          <arg value="-nv"/>
          
          <schema  dir="${basedir}/src/schema" includes="j2ee_1*.xsd,ejb-jar*.xsd"/> 
          <binding dir="${basedir}/src/etc" includes="*.xjb"/>
          
        <!--
          <produces dir="??" includes="* impl/*" />
        -->
        </xjc>
    </j:scope>
  </goal>
  	
  <goal name="generate:castor"
  	description="Generates the XML beans using Castor">
    <attainGoal name="castor:prepare-filesystem"/>

 	<j:set var="schema" value="${basedir}/src/schema/ejb-jar_2_1.xsd"/>
    <j:set var="gen" value="${pom.getPluginContext('maven-castor-plugin').getVariable('maven.castor.dest')}"/>
    
    <ant:java className="org.exolab.castor.builder.SourceGenerator"
              failonerror="true">
      <ant:arg value="-i"/>
      <ant:arg value="${schema}"/>
      <ant:arg value="-binding-file"/>
      <ant:arg value="${basedir}/src/etc/binding-configuration.xml"/>
      <ant:arg value="-package"/>
      <ant:arg value="org.apache.geronimo.xmlbeans.ejb"/>
      <ant:arg value="-types"/>
      <ant:arg value="j2"/>
      <ant:arg value="-nomarshall"/>
      <ant:arg value="-f"/>
      <ant:arg value="-dest"/>
      <ant:arg value="${gen}"/>
    </ant:java>   
    <!-- this does not currently support -binding-file 
    <castor:generate schema="${basedir}/src/schema/ejb-jar_2_1.xsd"
                     package="org.apache.geronimo.xmlbeans.ejb"
                     marshal="false"
                     types="j2"/>
    -->
  </goal>
</project>