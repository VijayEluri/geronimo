<?xml version="1.0" encoding="UTF-8"?>

<!-- $Revision: 1.3 $ $Date: 2004/02/17 07:26:47 $ -->

<project default="default"
    xmlns:j="jelly:core"
    xmlns:u="jelly:util"
    xmlns:ant="jelly:ant">

    <goal name="default">
        <attainGoal name="war"/>
    </goal>

    <!-- generate packages ready to be deployed, if appropriate -->
    <postGoal name="war">
        <ant:available property="geronimoServicePresent" file="${basedir}/src/etc/META-INF/geronimo-service.xml"/>
        <j:if test="${geronimoServicePresent == 'true'}">
            <ant:jar destfile="${basedir}/target/${pom.artifactId}-package-${pom.currentVersion}.jar">
                <fileset dir="${basedir}/target" includes="${pom.artifactId}-${pom.currentVersion}.jar"/>
                <fileset dir="${basedir}/target" includes="geronimo-web-console.war"/>

                <fileset dir="${basedir}/src/etc" includes="META-INF/geronimo-service.xml"/>
                <j:forEach var="artifact" items="${pom.artifacts}">
                    <j:set var="dependency" value="${artifact.dependency}"/>
                    <j:if test="${dependency.getProperty('package') == 'true'}">
                        <ant:echo>Processing dependency: ${dependency.id}</ant:echo>
                        <fileset file="${artifact.path}"/>
                    </j:if>
                </j:forEach>
            </ant:jar>
            <ant:property name="jardir__" value="${maven.repo.local}/${pom.artifactDirectory}/jars"/>
            <ant:mkdir dir="${jardir__}"/>
            <ant:copy
                file="${basedir}/target/${pom.artifactId}-package-${pom.currentVersion}.jar"
                todir="${jardir__}"
                overwrite="true"
                />
        </j:if>
    </postGoal>

    <!-- Remove the log files -->
    <goal name="clobber"
        description="Removes all (non-repository installed) build generated files">

        <!-- Let clean:clean do some work first -->
        <attainGoal name="clean:clean"/>

        <j:jelly xmlns="jelly:ant">
            <delete quiet="false" failonerror="false">
                <fileset dir="${basedir}">
                    <include name="maven.log"/>
                    <include name="velocity.log*"/>
                    <include name="junit*.properties"/>
                </fileset>
            </delete>
        </j:jelly>
    </goal>
</project>
