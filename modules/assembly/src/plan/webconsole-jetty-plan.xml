<?xml version="1.0" encoding="UTF-8"?>
<application
    xmlns="http://geronimo.apache.org/xml/ns/j2ee/application-1.0"
    configId="org/apache/geronimo/Console/Jetty"
    parentId="org/apache/geronimo/Server">

    <!-- these dependencies must be kept here so that their classes are loaded in the "EARs" classloader. -->
    <dependency>
        <groupId>portlet-api</groupId>
        <artifactId>portlet-api</artifactId>
        <version>${portlet_api_version}</version>
    </dependency>
    <dependency>
        <groupId>org.apache.pluto</groupId>
        <artifactId>pluto</artifactId>
        <version>${pluto_version}</version>
    </dependency>
    <dependency>
        <groupId>geronimo</groupId>
        <artifactId>geronimo-console-core</artifactId>
        <version>${geronimo_version}</version>
    </dependency>
    <!-- The following are for configuration and deployment via JSR-88 -->
    <dependency>
        <groupId>geronimo</groupId>
        <artifactId>geronimo-test-ddbean</artifactId>
        <version>${geronimo_version}</version>
    </dependency>
    <dependency>
        <groupId>geronimo</groupId>
        <artifactId>geronimo-deploy-jsr88</artifactId>
        <version>${geronimo_version}</version>
    </dependency>
    <dependency>
        <groupId>geronimo</groupId>
        <artifactId>geronimo-deploy-config</artifactId>
        <version>${geronimo_version}</version>
    </dependency>
    <dependency>
        <groupId>geronimo</groupId>
        <artifactId>geronimo-service-builder</artifactId>
        <version>${geronimo_version}</version>
    </dependency>
    <dependency>
        <groupId>geronimo</groupId>
        <artifactId>geronimo-connector-builder</artifactId>
        <version>${geronimo_version}</version>
    </dependency>
    <dependency>
        <groupId>geronimo</groupId>
        <artifactId>geronimo-j2ee-schema</artifactId>
        <version>${geronimo_version}</version>
    </dependency>
    <dependency>
        <groupId>xmlbeans</groupId>
        <artifactId>xbean</artifactId>
        <version>${xmlbeans_version}</version>
    </dependency>
    <dependency>
        <groupId>stax</groupId>
        <artifactId>stax-api</artifactId>
        <version>${stax_api_version}</version>
    </dependency>

    <!-- Keystore dependency -->
    <dependency>
        <groupId>geronimo</groupId>
        <artifactId>geronimo-util</artifactId>
        <version>${geronimo_version}</version>
    </dependency>
    <module>
        <web>geronimo-console-framework-${pom.currentVersion}.war</web>
        <web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web/jetty-1.0" configId="console">
            <context-root>/console</context-root>
            <context-priority-classloader>false</context-priority-classloader>
            <security-realm-name>geronimo-properties-realm</security-realm-name>
            <security>
                <default-principal>
                    <principal class="org.apache.geronimo.security.realm.providers.GeronimoUserPrincipal" name="system"/>
                </default-principal>
                <role-mappings>
                    <role role-name="admin">
                        <principal class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal" name="admin" designated-run-as="true"/>
                    </role>
                </role-mappings>
            </security>
        </web-app>
    </module>

    <module>
        <web>geronimo-console-standard-${pom.currentVersion}.war</web>
        <web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web/jetty-1.0" configId="console-standard">
            <context-root>/console-standard</context-root>
            <context-priority-classloader>false</context-priority-classloader>
        </web-app>
    </module>

    <!-- Console specific server info -->
    <gbean name="PropertiesLoginManager" class="org.apache.geronimo.console.core.security.PropertiesLoginModuleManager">
        <reference name="ServerInfo">
            <gbean-name>geronimo.server:J2EEApplication=null,J2EEModule=org/apache/geronimo/System,J2EEServer=geronimo,j2eeType=GBean,name=ServerInfo</gbean-name>
        </reference>
        <reference name="LoginModule">
            <!--            <gbean-name>geronimo.server:J2EEApplication=null,J2EEModule=org/apache/geronimo/Server,J2EEServer=geronimo,j2eeType=LoginModule,name=properties-login</gbean-name>-->
            <gbean-name>geronimo.server:J2EEApplication=null,J2EEModule=org/apache/geronimo/Security,J2EEServer=geronimo,j2eeType=LoginModule,name=properties-login</gbean-name>
        </reference>
    </gbean>

    <!-- Keystore configuration -->
    <gbean gbeanName="geronimo.security:type=KeyStore" class="org.apache.geronimo.console.core.keystore.KeyStoreGBean">
        <attribute name="keyStoreLocation">var/security/ssl-keystore-1</attribute>
        <attribute name="keyStoreType">jks</attribute>
        <attribute name="keyStoreProvider">SUN</attribute>
        <attribute name="keyStorePassword">password</attribute>
        <reference name="serverInfo">
            <application>null</application>
            <moduleType>J2EEModule</moduleType>
            <module>org/apache/geronimo/System</module>
            <type>GBean</type>
            <name>ServerInfo</name>
        </reference>
    </gbean>

</application>
