<?xml version="1.0" encoding="UTF-8"?>
<!--

Copyright 2004 The Apache Software Foundation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<!-- $Rev: 111627 $ $Date: 2004-12-12 03:15:11 +0100 (Sun, 12 Dec 2004) $ -->

<!--
Configuration for the main ring of a Geronimo server.

This configuration should contain those services normally provided
by the server.
-->
<configuration
    xmlns="http://geronimo.apache.org/xml/ns/deployment"
    configId="org/apache/geronimo/Tomcat"
    parentId="org/apache/geronimo/Server"
    >

    <dependency>
        <uri>geronimo/jars/geronimo-tomcat-builder-${geronimo_version}.jar</uri>
    </dependency>
    <dependency>
        <uri>geronimo/jars/geronimo-tomcat-${geronimo_version}.jar</uri>
    </dependency>
    <dependency>
        <uri>tomcat/jars/catalina-${tomcat_version}.jar</uri>
    </dependency>
    <dependency>
        <uri>tomcat/jars/catalina-optional-${tomcat_version}.jar</uri>
    </dependency>
    <dependency>
        <uri>tomcat/jars/tomcat-coyote-${tomcat_version}.jar</uri>
    </dependency>
    <dependency>
        <uri>tomcat/jars/tomcat-http-${tomcat_version}.jar</uri>
    </dependency>
    <dependency>
        <uri>tomcat/jars/tomcat-util-${tomcat_version}.jar</uri>
    </dependency>
    <dependency>
        <uri>tomcat/jars/naming-resources-${tomcat_version}.jar</uri>
    </dependency>
    <dependency>
        <uri>tomcat/jars/servlets-default-${tomcat_version}.jar</uri>
    </dependency>
    <dependency>
        <uri>tomcat/jars/servlets-invoker-${tomcat_version}.jar</uri>
    </dependency>
    <dependency>
        <uri>commons-beanutils/jars/commons-beanutils-1.6.1.jar</uri>
    </dependency>
    <dependency>
        <uri>commons-collections/jars/commons-collections-2.1.jar</uri>
    </dependency>
    <dependency>
        <uri>commons-digester/jars/commons-digester-1.6.jar</uri>
    </dependency>
    <dependency>
        <uri>commons-el/jars/commons-el-1.0.jar</uri>
    </dependency>
    <dependency>
        <uri>commons-modeler/jars/commons-modeler-1.1.jar</uri>
    </dependency>
    <dependency>
        <uri>regexp/jars/regexp-1.3.jar</uri>
    </dependency>
    <dependency>
        <uri>mx4j/jars/mx4j-${mx4j_version}.jar</uri>
    </dependency>
    <dependency>
        <uri>tomcat/jars/jasper-compiler-${jasper_version}.jar</uri>
    </dependency>
    <dependency>
        <uri>tomcat/jars/jasper-compiler-jdt-${jasper_version}.jar</uri>
    </dependency>
    <dependency>
        <uri>tomcat/jars/jasper-runtime-${jasper_version}.jar</uri>
    </dependency>
    <dependency>
        <uri>commons-el/jars/commons-el-${commons_el_version}.jar</uri>
    </dependency>

    <!-- JAAS Geronimo Login Configuration -->
    <gbean name="tomcat-properties-realm"
        class="org.apache.geronimo.security.realm.GenericSecurityRealm">
        <attribute name="realmName">Geronimo</attribute>
        <reference name="LoginModuleConfiguration">
            <name>properties-login</name>
        </reference>
        <reference name="ServerInfo">
            <module>org/apache/geronimo/System</module>
            <name>ServerInfo</name>
        </reference>
    </gbean>
    <gbean name="properties-login" class="org.apache.geronimo.security.jaas.JaasLoginModuleUse">
        <attribute name="controlFlag">REQUIRED</attribute>
        <reference name="LoginModule">
            <module>org/apache/geronimo/Server</module>
            <name>properties-login</name>
        </reference>
    </gbean>

    <gbean name="TomcatWebContainer" class="org.apache.geronimo.tomcat.TomcatContainer">
        <attribute name="catalinaHome">var/catalina</attribute>
        <reference name="engineGBean">
            <name>TomcatEngine</name>
        </reference>
        <reference name="ServerInfo">
            <module>org/apache/geronimo/System</module>
            <name>ServerInfo</name>
        </reference>
    </gbean>

    <gbean name="TomcatWebConnector" class="org.apache.geronimo.tomcat.ConnectorGBean">
        <attribute name="initParams">
            port=8090
        </attribute>
        <reference name="TomcatContainer">
            <name>TomcatWebContainer</name>
        </reference>
    </gbean>

    <!-- Uncomment for SSL support
    The following parameters assume your keystore resides in your ~/.keystore file and the keystore password is the default
    "changeit".  To change these values (and is recommended), add the following parameters to the initParams list below:

    keystoreFile=path_to_your_keystore
    keystorePass=your_keystore_password

    For more information on the specific parameters, see http://jakarta.apache.org/tomcat/tomcat-5.5-doc/ssl-howto.html

    <gbean name="TomcatWebSSLConnector" class="org.apache.geronimo.tomcat.ConnectorGBean">
        <attribute name="initParams">
            port=8443
            minProcessors=5
            maxProcessors=75
            enableLookups=true
            disableUploadTimeout=true
            acceptCount=100
            debug=0
            scheme=https
            secure=true
            clientAuth=false
            sslProtocol=TLS
        </attribute>
        <reference name="TomcatContainer"><name>TomcatWebContainer</name></reference>
    </gbean>
    -->

    <gbean name="TomcatEngine" class="org.apache.geronimo.tomcat.EngineGBean">
        <attribute name="className">org.apache.geronimo.tomcat.TomcatEngine</attribute>
        <attribute name="initParams">
            name=Geronimo
            defaultHost=localhost
        </attribute>
        <reference name="realmGBean">
            <name>TomcatJAASRealm</name>
        </reference>
    </gbean>

    <gbean name="TomcatJAASRealm" class="org.apache.geronimo.tomcat.RealmGBean">
        <attribute name="className">org.apache.geronimo.tomcat.realm.TomcatJAASRealm</attribute>
        <attribute name="initParams">
            userClassNames=org.apache.geronimo.security.realm.providers.GeronimoUserPrincipal
            roleClassNames=org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal
        </attribute>
    </gbean>

    <gbean name="TomcatHost" class="org.apache.geronimo.tomcat.HostGBean">
        <attribute name="className">org.apache.catalina.core.StandardHost</attribute>
        <attribute name="initParams">
            name=localhost
            appBase=
            workDir=work
        </attribute>
        <reference name="engineGBean">
            <name>TomcatEngine</name>
        </reference>
    </gbean>

</configuration>
