<?xml version="1.0" encoding="UTF-8"?>

<!-- $Id: maven.xml,v 1.2 2003/08/14 23:07:19 jstrachan Exp $ -->

<project
  xmlns:j="jelly:core"
  xmlns:u="jelly:util"
  xmlns:ant="jelly:ant"
  xmlns:castor="castor">
  
  <!-- ===================== -->
  <!-- Module Initialization -->
  <!-- ===================== -->
  
  <ant:property file="${basedir}/../../etc/project.properties"/>
  
  
  <!-- ================================= -->
  <!-- Compile XML->Java Binding Sources -->
  <!-- ================================= -->
  
  <preGoal name="java:compile">
	<attainGoal name="generate:xmlbeans"/>      
  </preGoal>

  <goal name="generate:xmlbeans"
  	description="Generates the XML beans using XMLBeans">

   	<!-- a dummy scope tag to change XML namespace to ant -->
  	<j:scope xmlns="jelly:ant">

<!--  	
 	   <j:set var="schema" value="${basedir}/src/schema/j2ee_1_4.xsd"/>
--> 	   
 	   <j:set var="schema" value="${basedir}/src/schema/ejb-jar_2_1.xsd"/>
 	   <j:set var="dir" value="${basedir}/target/src"/>

  	   <taskdef name="xmlbean" classname="com.bea.xbean.tool.XMLBean" classpathref="maven.dependency.classpath"/>
  
        <ant:mkdir dir="${dir}"/>
	
	    <xmlbean
	      destfile="${basedir}/target/xmlbeans.jar"
	      schema="${basedir}/src/schema"
	      srcgendir="${basedir}/target/src"
	      typesystemname="org.apache.geronimo.xmlbeans"
	      classpathref="maven.dependency.classpath"
	      srconly="true"
	      download="true"
	      failonerror="true" />
	
    </j:scope>
  </goal>
  	


  <goal name="generate:jaxb"
  	description="Generates the XML beans using JAXB">

   	<!-- a dummy scope tag to change XML namespace to ant -->
  	<j:scope xmlns="jelly:ant">

<!--  	
 	   <j:set var="schema" value="${basedir}/src/schema/j2ee_1_4.xsd"/>
--> 	   
 	   <j:set var="schema" value="${basedir}/src/schema/ejb-jar_2_1.xsd"/>
 	   <j:set var="dir" value="${basedir}/target/src"/>
    
        <taskdef name="xjc" classname="com.sun.tools.xjc.XJCTask">
          <classpath refid="maven.dependency.classpath" />
    	</taskdef>
        
        <ant:mkdir dir="${dir}"/>
        
        <xjc target="${dir}" package="org.apache.geronimo.xmlbeans.ejb" extension="true">
          <arg value="-nv"/>
          
          <schema  dir="${basedir}/src/schema" includes="j2ee_1*.xsd,ejb-jar*.xsd"/> 
          <binding dir="${basedir}/src/etc" includes="*.xjb"/>
          
        <!--
          <produces dir="??" includes="* impl/*" />
        -->
        </xjc>
    </j:scope>
  </goal>
  	
  <goal name="generate:castor"
  	description="Generates the XML beans using Castor">
    <attainGoal name="castor:prepare-filesystem"/>

 	<j:set var="schema" value="${basedir}/src/schema/ejb-jar_2_1.xsd"/>
    <j:set var="gen" value="${pom.getPluginContext('maven-castor-plugin').getVariable('maven.castor.dest')}"/>
    
    <ant:java className="org.exolab.castor.builder.SourceGenerator"
              failonerror="true">
      <ant:arg value="-i"/>
      <ant:arg value="${schema}"/>
      <ant:arg value="-binding-file"/>
      <ant:arg value="${basedir}/src/etc/binding-configuration.xml"/>
      <ant:arg value="-package"/>
      <ant:arg value="org.apache.geronimo.xmlbeans.ejb"/>
      <ant:arg value="-types"/>
      <ant:arg value="j2"/>
      <ant:arg value="-nomarshall"/>
      <ant:arg value="-f"/>
      <ant:arg value="-dest"/>
      <ant:arg value="${gen}"/>
    </ant:java>   
    <!-- this does not currently support -binding-file 
    <castor:generate schema="${basedir}/src/schema/ejb-jar_2_1.xsd"
                     package="org.apache.geronimo.xmlbeans.ejb"
                     marshal="false"
                     types="j2"/>
    -->
  </goal>
</project>