<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- $Revision: 1.26 $ $Date: 2004/02/11 03:14:10 $ -->

<project default="default"
    xmlns:j="jelly:core"
    xmlns:ant="jelly:ant"
    xmlns:maven="jelly:maven"
    xmlns:xdoclet="common:xdoclet"
    xmlns:castor="common:castor">

    <preGoal name="xdoc:jelly-transform">
        <attainGoal name="html2xdoc"/>
    </preGoal>

    <postGoal name="jar:jar">
        <ant:jar destfile="${basedir}/target/jsr88-geronimo-plugin.jar"
            basedir="${basedir}/target/classes"
            includes="org/apache/geronimo/enterprise/deploy/server/**/*.class"
            manifest="${basedir}/src/etc/jsr88-product-provider-manifest.mf"/>
    </postGoal>

    <postGoal name="jar:jar">
        <ant:jar destfile="${basedir}/target/geronimo-core-rmiclassloaderspi.jar"
            basedir="${basedir}/target/classes"
            includes="org/apache/geronimo/rmi/RMIClassLoaderSpiImpl.class"/>
    </postGoal>

    <postGoal name="jar:jar">
        <ant:jar destfile="${basedir}/target/geronimo-schemas.jar"
            basedir="${basedir}/src/schema"
            includes="*.xsd"/>
    </postGoal>

    <postGoal name="jar:jar">
        <ant:jar destfile="${basedir}/target/log4j-service-${pom.currentVersion}.jar">
            <fileset dir="${basedir}/target/classes" includes="org/apache/geronimo/core/logging/log4j/**/*.class"/>
            <fileset dir="${basedir}/src/etc/logging" includes="META-INF/geronimo-service.xml"/>
            <j:forEach var="artifact" items="${pom.artifacts}">
                <j:set var="dependency" value="${artifact.dependency}"/>
                <j:if test="${dependency.getProperty('log4j-service') == 'true'}">
                    <fileset file="${artifact.path}"/>
                </j:if>
            </j:forEach>
        </ant:jar>
    </postGoal>

    <postGoal name="jar:install">
        <ant:property name="jardir__" value="${maven.repo.local}/${pom.artifactDirectory}/jars"/>
        <ant:mkdir dir="${jardir__}"/>
        <ant:copy
            file="${basedir}/target/log4j-service-${pom.currentVersion}.jar"
            todir="${jardir__}"
            overwrite="true"
            />
    </postGoal>

    <postGoal name="java:compile">
        <!-- generate the version properties file -->
        <j:new var="now" className="java.util.Date"/>
        <j:new var="dateFormat" className="java.text.SimpleDateFormat">
            <j:arg type="java.lang.String" value="yyyy.MM.dd"/>
        </j:new>
        <j:new var="timeFormat" className="java.text.SimpleDateFormat">
            <j:arg type="java.lang.String" value="HH:mm:ss.SSSZ"/>
        </j:new>
        <j:new var="yearFormat" className="java.text.SimpleDateFormat">
            <j:arg type="java.lang.String" value="yyyy"/>
        </j:new>
        <ant:echo file="${basedir}/target/classes/org/apache/geronimo/core/serverinfo/geronimo-version.properties">##### Generated by Maven ####
version=${pom.currentVersion}
build.date=${dateFormat.format(now)}
build.time=${timeFormat.format(now)}
copyright=Copyright (C) 2003-${yearFormat.format(now)}, The Apache Software Foundation
</ant:echo>
    </postGoal>

    <postGoal name="jar:jar">
        <!-- build the server-info jar -->
        <ant:jar destfile="${basedir}/target/server-info-${pom.currentVersion}.jar">
            <fileset dir="${basedir}/target/classes" includes="org/apache/geronimo/core/serverinfo/**/*"/>
            <fileset dir="${basedir}/src/etc/serverinfo" includes="META-INF/geronimo-service.xml"/>
        </ant:jar>
    </postGoal>

    <postGoal name="jar:install">
        <ant:property name="jardir__" value="${maven.repo.local}/${pom.artifactDirectory}/jars"/>
        <ant:mkdir dir="${jardir__}"/>
        <ant:copy
            file="${basedir}/target/server-info-${pom.currentVersion}.jar"
            todir="${jardir__}"
            overwrite="true"
            />
    </postGoal>
</project>
